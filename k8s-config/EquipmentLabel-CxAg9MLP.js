import{j as B,R as E,k as w,r as L,h as O,a9 as R,l as m,m as T,w as l,c as s,q as g,b as y,B as j,C as V,G as D,aZ as F,P as f,v as I,a_ as A,y as k,Q as z,N as G,d as K,x as N,a$ as Q,b0 as Z,F as J,b1 as W,L as X}from"./index-BQql7DrZ.js";import{a as ee,b as ae}from"./regExp-B6gnsrw9.js";const te=B({__name:"EditModal",props:{record:{}},emits:["cancel","reload"],setup(S,{emit:h}){const r=S,d=E(),n=w({}),c=L(),_=O(()=>{var a;return(a=r.record)!=null&&a.id?"编辑":"新增"}),v=async()=>{var o,u;const a=await((o=c.value)==null?void 0:o.validate());try{(u=r.record)!=null&&u.id?await d.put("/api/dop/v1/label/update",{...a,id:r.record.id}):await d.post("/api/dop/v1/label/save",a)}catch(i){y.error((i==null?void 0:i.desc)||"保存失败");return}y.success("成功！"),h("cancel"),h("reload")};return R(()=>r.record,a=>{var o;a?(n.code=a.code,n.name=a.name):((o=c.value)==null||o.resetFields(),n.code=void 0,n.name=void 0)}),(a,o)=>{const u=j,i=V,b=D,C=F;return m(),T(C,{open:!!a.record,onCancel:o[2]||(o[2]=t=>a.$emit("cancel")),onOk:v,title:_.value,centered:""},{default:l(()=>[s(b,{ref_key:"formRef",ref:c,layout:"vertical",model:n},{default:l(()=>[s(i,{label:"标签编码",name:"code",rules:[{required:!0,message:"标签编码为必填项！"},{message:"请输入1~20位英文、数字、下划线组合",pattern:g(ee)}]},{default:l(()=>[s(u,{placeholder:"请输入",value:n.code,"onUpdate:value":o[0]||(o[0]=t=>n.code=t),maxlength:"20"},null,8,["value"])]),_:1},8,["rules"]),s(i,{label:"设备标签",name:"name",rules:[{required:!0,message:"设备标签为必填项！"},{message:"请输入正确的格式",pattern:g(ae)}]},{default:l(()=>[s(u,{placeholder:"请输入",value:n.name,"onUpdate:value":o[1]||(o[1]=t=>n.name=t),maxlength:"50"},null,8,["value"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),ne={class:"table-view-wrap"},oe={class:"page-list-header"},se={class:"page-list-header-right"},le={key:0},de={key:1},ie=B({__name:"EquipmentLabel",setup(S){const h=[{title:"标签编码",dataIndex:"code",key:"code",width:"15%",ellipsis:!0},{title:"设备标签",dataIndex:"name",key:"name",width:"20%",ellipsis:!0},{title:"来源",dataIndex:"type",key:"type",width:"15%"},{title:"创建者",dataIndex:"userName",key:"userName",width:"15%"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",width:"20%"},{title:"操作",key:"Operating",width:"15%"}],r=E(),d=w({loading:!1,data:[]}),n=w({total:0,current:1,pageSize:15}),c=w({}),_=O(()=>({pageNumber:n.current,pageSize:n.pageSize,...c})),v=L(),a=async t=>{d.loading=!0;try{const e=await r.get("/api/dop/v1/label/page",t);d.data=e.list||[],n.total=e.total??0}catch(e){y.error((e==null?void 0:e.desc)||"获取数据失败")}finally{d.loading=!1}},o=t=>{F.confirm({centered:!0,title:"确认删除？",onOk:async()=>{try{await r.delete(`/api/dop/v1/label/${t==null?void 0:t.id}`)}catch(e){y.error((e==null?void 0:e.desc)||"删除失败");return}y.success("成功！"),await a(_.value)}})},u=t=>{v.value=t},i=()=>{v.value={}},b=()=>{v.value=void 0},C=(t,e)=>{n.current=t,n.pageSize=e};return R(_,t=>{a(t)},{immediate:!0}),(t,e)=>{const M=Z,P=V,U=D,x=J,Y=W;return m(),f("div",ne,[s(g(Q),{rowKey:"id",columns:h,loading:d.loading,"data-source":d.data,pagination:n,onChangePagination:C},{tableViewHeader:l(()=>[I("div",oe,[s(U,{layout:"inline",name:"page_list_search",class:"page-list-header-search"},{default:l(()=>[s(P,{name:"name"},{default:l(()=>[s(M,{style:{width:"240px"},allowClear:"",placeholder:"标签编码/设备标签",maxLength:30,value:c.name,"onUpdate:value":e[0]||(e[0]=p=>c.name=p),onSearch:e[1]||(e[1]=p=>a(_.value))},null,8,["value"])]),_:1})]),_:1}),I("div",se,[s(x,{onClick:i},{default:l(()=>[s(g(A)),k(" 新增")]),_:1})])])]),bodyCell:l(({column:p,text:$,record:q})=>[p.key==="updateTime"?(m(),f(z,{key:0},[k(G(g(K)($).format("YYYY-MM-DD HH:mm:ss")),1)],64)):N("",!0),p.key==="type"?(m(),f(z,{key:1},[Number($)===0?(m(),f("span",le,"自定义")):(m(),f("span",de,"同步"))],64)):N("",!0),p.key==="Operating"?(m(),T(Y,{key:2},{default:l(()=>[s(x,{size:"small",type:"link",onClick:H=>u(q)},{default:l(()=>[k("编辑")]),_:2},1032,["onClick"]),s(x,{size:"small",type:"link",onClick:H=>o(q)},{default:l(()=>[k("删除")]),_:2},1032,["onClick"])]),_:2},1024)):N("",!0)]),_:1},8,["loading","data-source","pagination"]),s(te,{record:v.value,onCancel:b,onReload:e[2]||(e[2]=p=>a(_.value))},null,8,["record"])])}}}),ue=X(ie,[["__scopeId","data-v-fcd9d770"]]);export{ue as default};
